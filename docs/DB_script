CREATE DATABASE student_timetable;
use student_timetable;

CREATE TABLE users (
    user_id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(64) NOT NULL,
    surname VARCHAR(64) NOT NULL,
    email VARCHAR(64) NOT NULL UNIQUE,
    phone_number VARCHAR(64) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role enum('student','teacher','admin') NOT NULL
);

CREATE TABLE student_groups (
    group_code VARCHAR(64) NOT NULL PRIMARY KEY,
    field_of_studies VARCHAR(64) NOT NULL
);

CREATE TABLE student_profiles (
    user_id INT PRIMARY KEY,
    study_start_date TIMESTAMP NOT NULL,
    study_end_date DATE NOT NULL,
    group_code VARCHAR(64),
    foreign key (user_id) references users(user_id) ON DELETE CASCADE,
    foreign key (group_code) references student_groups (group_code)
);

CREATE TABLE courses (
    course_id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(64) NOT NULL,
    color_code VARCHAR(64) NOT NULL
);


CREATE TABLE lessons (
    lesson_id INT PRIMARY KEY AUTO_INCREMENT,
    start_at TIMESTAMP NOT NULL,
    end_at TIMESTAMP NOT NULL,
    course_id INT NOT NULL,
    class VARCHAR(64) NOT NULL,
    foreign key (course_id) references courses(course_id) ON DELETE CASCADE
);

CREATE TABLE assigned_groups (
    lesson_id INT NOT NULL,
    group_code VARCHAR(64) NOT NULL,
    primary key (lesson_id,group_code),
    foreign key (lesson_id) references lessons(lessons_id) ON DELETE CASCADE,
    foreign key (group_code) references student_groups (group_code) ON DELETE CASCADE
);

CREATE TABLE assigned_users (
    lesson_id INT NOT NULL,
    user_id INT NOT NULL,
    primary key (lesson_id, user_id),
    foreign key (user_id) references users(user_id) ON DELETE CASCADE,
    foreign key (lesson_id) references lessons(lesson_id) ON DELETE CASCADE
);

CREATE TABLE messages (
    message_id INT PRIMARY KEY AUTO_INCREMENT,
    content TEXT not null,
    sent_at TIMESTAMP NOT NULL,
    sender_user_id INT NOT NULL,
    recipient_user_id INT NOT NULL,
    foreign key (sender_user_id) references users(user_id),
    foreign key (recipient_user_id) references users(user_id)
);

