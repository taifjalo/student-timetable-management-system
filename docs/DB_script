CREATE DATABASE student_timetable;
use student_timetable;

CREATE TABLE users (
    user_id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(64) NOT NULL,
    surname VARCHAR(64) NOT NULL,
    email VARCHAR(64) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role enum('student','teacher') NOT NULL
);

CREATE TABLE student_groups (
    group_code VARCHAR(64) NOT NULL PRIMARY KEY,
    field_of_studies VARCHAR(64) NOT NULL
);

CREATE TABLE student_profiles (
    user_id INT PRIMARY KEY,
    study_start_date TIMESTAMP NOT NULL,
    study_end_date DATE NOT NULL,
    group_code VARCHAR(64),
    foreign key (user_id) references users(user_id) ON DELETE CASCADE,
    foreign key (group_code) references student_groups (group_code)
);


CREATE TABLE lessons (
    lesson_id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(64) NOT NULL,
    start_at TIMESTAMP NOT NULL,
    end_at TIMESTAMP NOT NULL,
    group_code VARCHAR(64),
    foreign key (group_code) references student_groups(group_code)
);

CREATE TABLE assigned (
    user_id INT NOT NULL,
    lesson_id INT NOT NULL,
    primary key (user_id, lesson_id),
    foreign key (user_id) references users(user_id) ON DELETE CASCADE,
    foreign key (lesson_id) references lessons(lesson_id) ON DELETE CASCADE
);

CREATE TABLE messages (
    message_id INT PRIMARY KEY AUTO_INCREMENT,
    content TEXT not null,
    sent_at TIMESTAMP NOT NULL,
    sender_user_id INT NOT NULL,
    recipient_user_id INT NOT NULL,
    foreign key (sender_user_id) references users(user_id),
    foreign key (recipient_user_id) references users(user_id)
);

